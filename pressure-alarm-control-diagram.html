<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Alarm Control Diagram</title>
    <script type="module">
        import { Mermaid } from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.js';
        Mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        .mermaid {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .export-button {
            margin: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .description-panel {
            margin: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Pressure Alarm Control Diagram</h1>
    <button class="export-button" onclick="exportToPNG()">Export to PNG</button>
    <div class="mermaid">
        graph TD;
            A[Room 101 DP Sensor] -->|Input| B[AHU Status];
            A -->|Input| C[Occupancy Schedule];
            B --> D[DP Setpoint (+0.03"wc)];
            B --> E[DP Setpoint (-0.015"wc)];
            D --> F[High Alarm (Occupied)];
            E --> G[Low Alarm (Occupied)];
            F --> H[Alarm Multiplexer];
            G --> H;
            C --> I[Sign Change Detector (Unoccupied)];
            C --> J[Direction Change Alarm (Unoccupied)];
            I --> H;
            J --> H;
            H --> K[Final Alarm Output];
            F --> L[5-minute Delay Timer];
            G --> M[30-minute Override Timer];
            L --> N[AHU Override Command];
            M --> N;
            N --> O[Mode Select Logic];
            O --> H;
    </div>
    <div class="description-panel">
        <h2>Control Sequence Description</h2>
        <p>This diagram represents the flow of control signals in the pressure alarm system, illustrating how the inputs from the Room 101 DP sensor, AHU status, and occupancy schedule influence the alarm outputs under different conditions.</p>
    </div>
    <script>
        function exportToPNG() {
            const mermaidDiv = document.querySelector('.mermaid');
            mermaidDiv.innerHTML = mermaidDiv.innerHTML; // Re-render to ensure it is up-to-date
            mermaid.render('graphDiv', mermaidDiv.innerHTML, function(svgCode) {
                const svgBlob = new Blob([svgCode], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(svgBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'pressure_alarm_control_diagram.png';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>